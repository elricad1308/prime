/** life-game.js - Conway's Game of Life in JS V1.0 2015/12/04 */
var INITIAL_PROB=0.1;var LifeGame={clear:false,columns:0,generation:0,rows:0,running:false,waitTime:Math.ceil(1000/15),colors:{empty:'#fff',dead:'#ccc',alive:['#9898FF','#8585FF','#7272FF','#5F5FFF','#4C4CFF','#3939FF','#2626FF','#1313FF','#0000FF','#1313FF','#2626FF','#3939FF','#4C4CFF','#5F5FFF','#7272FF','#8585FF']},sizes:{current:-1,schemes:[{columns:40,rows:30,cellSize:4},{columns:120,rows:90,cellSize:4},{columns:100,rows:75,cellSize:8}]},cleanUp:function(){this.listLife.init();this.prepare();},init:function(){try{this.listLife.init();this.rows=this.sizes.schemes[this.sizes.current].rows;this.columns=this.sizes.schemes[this.sizes.current].columns;this.randomState();this.canvas.init();this.prepare();}catch(e){console.log("Error: "+e);}},mousePosition:function(e){var cellSize=LifeGame.sizes.schemes[LifeGame.sizes.current].cellSize+1;var posx=0,posy=0,top=0,left=0;var event,x,y,domObject;event=e;if(!event)event=window.event;if(event.pageX||event.pageY){posx=event.pageX;posy=event.pageY;}else if(event.clientX||event.clientY){posx=event.clientX+document.body.scrollLeft+document.documentElement.scrollLeft;posy=event.clientY+document.body.scrollTop+document.documentElement.scrollTop;}domObject=event.target||event.srcElement;while(domObject.offsetParent){left+=domObject.offsetLeft;top+=domObject.offsetTop;domObject=domObject.offsetParent;}domObject.pageTop=top;domObject.pageLeft=left;x=Math.ceil(((posx-domObject.pageLeft)/cellSize)-1);y=Math.ceil(((posy-domObject.pageTop)/cellSize)-1);return [x,y];},nextStep:function(){var i,x,y,r,liveCellNumber;liveCellNumber=this.listLife.nextGeneration();for(i=0;i<this.listLife.redrawList.length;i++){x=this.listLife.redrawList[i][0];y=this.listLife.redrawList[i][1];if(this.listLife.redrawList[i][2]===1)this.canvas.changeCellToAlive(x,y);else if(this.listLife.redrawList[i][2]===2)this.canvas.keepCellAlive(x,y);else this.canvas.changeCellToDead(x, y);}this.generation++;$('#gen_lbl').html(this.generation);$('#cells_lbl').html(liveCellNumber);if(this.running)setTimeout(function(){LifeGame.nextStep();},this.waitTime);else if(this.clear)this.cleanUp();},prepare:function(){this.generation=0;this.clear=false;$('#gen_lbl').html('0');$('#cells_lbl').html('0');this.canvas.clearWorld();this.canvas.drawWorld();},random:function(min,max){return min+Math.round(Math.random()*(max-min));},randomState : function() {var i,liveCells=(this.rows*this.columns)*INITIAL_PROB;for(i=0;i<liveCells;i++)this.listLife.addCell(this.random(0,this.columns-1),this.random(0,this.rows-1),this.listLife.actualState);this.listLife.nextGeneration();},canvas:{age:null,cellSize:null,cellSpace:null,context:null,height:null,width:null,changeCellToAlive:function(i,j){if(i>=0&&i<LifeGame.columns&&j>=0&&j<LifeGame.rows){this.age[i][j]=1;this.drawCell(i,j,true);}},changeCellToDead:function(i,j){if(i>=0&&i<LifeGame.columns&&j>=0&&j<LifeGame.rows){this.age[i][j]=-this.age[i][j];this.drawCell(i,j,false)}},clearWorld:function(){var i,j;this.age=[];for(i=0;i<LifeGame.columns;i++){this.age[i]=[];for(j=0;j<LifeGame.rows;j++)this.age[i][j]=0;}},drawCell:function(i,j,alive){if(alive){if(this.age[i][j]>-1)this.context.fillStyle=LifeGame.colors.alive[Math.floor(this.age[i][j]/LifeGame.colors.alive.length)%LifeGame.colors.alive.length];}else{if(this.age[i][j]<0)this.context.fillStyle=LifeGame.colors.dead;else this.context.fillStyle=LifeGame.colors.empty;}this.context.fillRect(this.cellSpace+(this.cellSpace*i)+(this.cellSize*i),this.cellSpace+(this.cellSpace*j)+(this.cellSize*j),this.cellSize,this.cellSize);},drawWorld:function(){var i,j;this.width=this.height=1;this.width=this.width+(this.cellSpace*LifeGame.columns)+(this.cellSize*LifeGame.columns);this.canvas.setAttribute('width',this.width);this.height=this.height+(this.cellSpace*LifeGame.rows)+(this.cellSize*LifeGame.rows);this.canvas.setAttribute('height',this.height);this.context.fillStyle='#f3f3f3';this.context.fillRect(0,0,this.width,this.height);for(i=0;i<LifeGame.columns;i++)for(j=0;j<LifeGame.rows;j++)if(LifeGame.listLife.isAlive(i,j))this.drawCell(i,j,true);else this.drawCell(i,j,false);},init:function(){this.canvas=document.getElementById('lifegame');this.context=this.canvas.getContext('2d');this.cellSize=LifeGame.sizes.schemes[LifeGame.sizes.current].cellSize;this.cellSpace=1;$('#lifegame').mousedown(LifeGame.handlers.canvasMouseDown);this.clearWorld();},keepCellAlive:function(i,j){if(i>=0&&i<LifeGame.columns&&j>=0&&j<LifeGame.rows){this.age[i][j]++;this.drawCell(i,j,true);}},switchCell:function(i,j){if(LifeGame.listLife.isAlive(i,j)){this.changeCellToDead(i,j);LifeGame.listLife.removeCell(i,j,LifeGame.listLife.actualState);}else{this.changeCellToAlive(i,j);LifeGame.listLife.addCell(i,j,LifeGame.listLife.actualState);}}},handlers : {canvasMouseDown:function(event){var position=LifeGame.mousePosition(event);LifeGame.canvas.switchCell(position[0],position[1]);},clear:function(){if(LifeGame.running){LifeGame.clear=true;LifeGame.running=false;$('#buttonRun').text('Run');}else LifeGame.cleanUp();},run:function(){LifeGame.running=!LifeGame.running;if(LifeGame.running){LifeGame.nextStep();$('#buttonRun').text('Stop');}else $('#buttonRun').text('Run');},step:function(){if(!LifeGame.running)LifeGame.nextStep();},},listLife:{actualState:[],bottomPointer:1,middlePointer:1,redrawList:[],topPointer:1,addCell:function(x,y,state){if(state.length===0){state.push([y,x]);return;}var k,n,m,tempRow,newState=[],added;if(y<state[0][0]){newState=[[y,x]];for(k=0;k<state.length;k++){newState[k+1]=state[k];}for(k=0;k<newState.length;k++){state[k]=newState[k];}return;}else if(y>state[state.length-1][0]){state[state.length]=[y,x];}else{for(n=0;n<state.length;n++){if(state[n][0]===y){tempRow=[];added=false;for(m=1;m<state[n].length;m++){if((!added)&&(x<state[n][m])){tempRow.push(x);added=!added;}tempRow.push(state[n][m]);}tempRow.unshift(y);if(!added){tempRow.push(x);}state[n]=tempRow;return;}if(y<state[n][0]){newState=[];for(k=0;k<state.length;k++){if(k===n){newState[k]=[y,x];newState[k+1]=state[k];}else if(k<n){newState[k]=state[k];}else if(k>n){newState[k+1]=state[k];}}for(k=0;k<newState.length;k++){state[k]=newState[k];}return;}}}},getNeighborsFromAlive:function(x,y,i,possibleNeighborsList){var neighbors=0,k;if(this.actualState[i-1]!==undefined){if(this.actualState[i-1][0]===(y-1)){for(k=this.topPointer;k<this.actualState[i-1].length;k++){if(this.actualState[i-1][k]>=(x-1)){if(this.actualState[i-1][k]===(x-1)){possibleNeighborsList[0]=undefined;this.topPointer=k+1;neighbors++;}if(this.actualState[i-1][k]===x){possibleNeighborsList[1]=undefined;this.topPointer=k;neighbors++;}if(this.actualState[i-1][k]===(x+1)){possibleNeighborsList[2]=undefined;if(k==1)this.topPointer=1;else this.topPointer=k-1;neighbors++;}if(this.actualState[i-1][k]>(x+1))break;}}}}for(k=1;k<this.actualState[i].length;k++){if(this.actualState[i][k]>=(x-1)){if(this.actualState[i][k]===(x-1)){possibleNeighborsList[3]=undefined;neighbors++;}if(this.actualState[i][k]===(x+1)){possibleNeighborsList[4]=undefined;neighbors++;}if(this.actualState[i][k]>(x+1))break;}}if(this.actualState[i+1]!==undefined){if(this.actualState[i+1][0]===(y+1)){for(k=this.bottomPointer;k<this.actualState[i+1].length;k++){if(this.actualState[i+1][k]>=(x-1)){if(this.actualState[i+1][k]===(x-1)){possibleNeighborsList[5]=undefined;this.bottomPointer=k+1;neighbors++;}if(this.actualState[i+1][k]===x){possibleNeighborsList[6]=undefined;this.bottomPointer=k;neighbors++;}if(this.actualState[i+1][k]===(x+1)){possibleNeighborsList[7]=undefined;if(k == 1)this.bottomPointer=1;else this.bottomPointer=k-1;neighbors++;}if(this.actualState[i+1][k]>(x+1))break;}}}}return neighbors;},init:function(){this.actualState=[];},isAlive:function(x,y){var i,j;for(i=0;i<this.actualState.length;i++)if(this.actualState[i][0]===y)for(j=1;j<this.actualState[i].length;j++)if(this.actualState[i][j]===x)return true;return false;},nextGeneration:function(){var x,y,i,j,m,n,key,t1,t2,alive=0,neighbors,deadNeighbors,allDeadNeighbors={},newState=[];this.redrawList=[];for(i=0;i<this.actualState.length;i++){this.topPointer=1;this.bottomPointer=1;for(j=1;j<this.actualState[i].length;j++){x=this.actualState[i][j];y=this.actualState[i][0];deadNeighbors=[[x-1,y-1,1],[x,y-1,1],[x+1,y-1,1],[x-1,y,1],[x+1,y,1],[x-1,y+1,1],[x,y+1,1],[x+1,y+1,1]];neighbors=this.getNeighborsFromAlive(x,y,i,deadNeighbors);for(m=0;m<8;m++){if(deadNeighbors[m]!==undefined){key=deadNeighbors[m][0]+','+deadNeighbors[m][1];if(allDeadNeighbors[key]===undefined)allDeadNeighbors[key]=1;else allDeadNeighbors[key]++;}}if(!(neighbors===0||neighbors===1||neighbors>3)){this.addCell(x,y,newState);alive++;this.redrawList.push([x,y,2]);}else this.redrawList.push([x,y,0]);}}for(key in allDeadNeighbors){if(allDeadNeighbors[key]===3){key=key.split(',');t1=parseInt(key[0],10);t2=parseInt(key[1],10);this.addCell(t1,t2,newState);alive++;this.redrawList.push([t1,t2,1]);}}this.actualState=newState;return alive;},removeCell:function(x,y,state) {var i,j;for(i=0;i<state.length;i++)if(state[i][0]===y){if(state[i].length===2)state.splice(i,1);else for(j=1;j<state[i].length;j++)if(state[i][j]===x)state[i].splice(j,1);}}}};$(document).ready(function(){$(window).resize(redraw);$('#buttonRun').click(LifeGame.handlers.run);$('#buttonStep').click(LifeGame.handlers.step);$('#buttonClear').click(LifeGame.handlers.clear);redraw();});function redraw(){var winWidth=window.innerWidth;var tempSize;if(winWidth>900)tempSize=2;else if(winWidth>550)tempSize=1;else tempSize=0;if(tempSize!=LifeGame.sizes.current){LifeGame.running=false;LifeGame.sizes.current=tempSize;LifeGame.init();setTimeout(function(){LifeGame.running=true;LifeGame.nextStep();$('#buttonRun').text('Stop');},1000);}}