/**
* bcc.js
*
* Este script contiene los datos de la simulacion del experimento con
* el protocolo BCC (Blocked Customer Cleared).
*
* @author Jose Aguilar-Canepa
*/

/** 
* Estos datos corresponden a la resolucion de la cadena utilizando 
* el metodo recursivo.
*/
var recursive = [
  [1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [1.0, 0.1, 0.05, 0.03333333333333333, 0.025, 0.02, 0.016666666666666666, 0.014285714285714285, 0.0125, 0.01111111111111111],
  [1.0, 0.2, 0.13333333333333333, 0.11428571428571428, 0.10666666666666666, 0.1032258064516129, 0.10158730158730159, 0.10078740157480315, 0.1003921568627451, 0.10019569471624265],
  [1.0, 0.3, 0.225, 0.2076923076923077, 0.20249999999999999, 0.20082644628099175, 0.20027472527472528, 0.20009149130832574, 0.20003048780487806, 0.20001016156894624],
  [1.0, 0.4, 0.32, 0.30476190476190473, 0.30117647058823527, 0.3002932551319648, 0.3000732600732601, 0.3000183116645303, 0.300004577706569, 0.30000114441354525],
  [1.0, 0.5, 0.4166666666666667, 0.4032258064516129, 0.40064102564102566, 0.40012804097311144, 0.4000256016385048, 0.4000051200655369, 0.40000102400262144, 0.4000002048001049],
  [1.0, 0.6, 0.5142857142857143, 0.5023255813953489, 0.5003861003861003, 0.5000643086816721, 0.5000107169649556, 0.5000017861289228, 0.5000002976872676, 0.5000000496145199],
  [1.0, 0.7, 0.6125, 0.6017543859649123, 0.6002500000000001, 0.600035701535166, 0.6000050999592003, 0.600000728560292, 0.6000001040799334, 0.6000000148685597],
  [1.0, 0.8, 0.711111111111111, 0.7013698630136986, 0.7001709401709402, 0.7000213629566332, 0.7000026702982722, 0.7000003337861699, 0.7000000417232538, 0.7000000052154064],
  [1.0, 0.9, 0.8099999999999999, 0.8010989010989011, 0.8001219512195122, 0.8000135482996884, 0.8000015053439711, 0.8000001672601614, 0.8000000185844589, 0.8000000020649398]
];

/**
* Estos datos corresponden a la resolucion de la cadena utilizando
* una simulacion de la cadena.
*/
var simulated = [
  [1.0, -0.09534031474183882, 0.03581873832161183, -0.09780351534998748, 0.06324358452416338, 0.040364674696226566, -0.06702452016004022, 0.05450397283715791, 0.008463283687390433, -0.02591781399496603],
  [1.0, 0.09641615776301576, 0.04530833871600509, 0.025031863722004884, 0.01370868186647425, 0.031582187797628586, 0.09561851135804125, 0.027443833945263237, 0.02079725131750485, -0.02556959785405932],
  [1.0, 0.151596986447278, 0.07669814915110645, 0.17430305074295424, 0.00876066217551208, 0.16451183148408619, 0.10216182106376445, 0.09670767855332575, 0.12973852401439465, 0.02029454190814456],
  [1.0, 0.34694763664415856, 0.21664603254674794, 0.14379712883511883, 0.18421635014159604, 0.2240643126515295, 0.10831987107085055, 0.2782735159368963, 0.1940220033270925, 0.12705455598490234],
  [1.0, 0.46944567687276284, 0.3628321982910331, 0.2762470825101441, 0.2932492506445599, 0.38142485444534246, 0.25287807338814106, 0.2806773757843914, 0.2960063118272545, 0.20266739618304586],
  [1.0, 0.5926827717191334, 0.4213267874652394, 0.3564341578521917, 0.39110639607907005, 0.32627064654213367, 0.3745173292307019, 0.4591664424877132, 0.4462865344869002, 0.4914115722852487],
  [1.0, 0.6880937304284972, 0.44730352495319137, 0.5790919712781378, 0.43420850744746353, 0.48248427664677984, 0.41509392452951865, 0.5898909740786304, 0.4516878999086241, 0.48426786064363087],
  [1.0, 0.7287994371110729, 0.6743347531638817, 0.5609632739366953, 0.5524328957752158, 0.6863140954467553, 0.6499194671938127, 0.5186437124813934, 0.590851322615688, 0.5976432681536605],
  [1.0, 0.8756462993245141, 0.6590468238491561, 0.7480387797443794, 0.6386983664681777, 0.6150832586666359, 0.6894471195878072, 0.7359538660863058, 0.6272409850072919, 0.6017347673544208],
  [1.0, 0.8377853034385658, 0.8490362489153888, 0.8912240413427147, 0.8888585952298975, 0.7826779998660867, 0.8934403474842447, 0.7762027996219127, 0.8509379529580311, 0.7975529739711582]
];

/**
* Estos datos corresponden a la resolucion de la cadena mediante el 
* metodo de Gauss-Seidel.
*/
var gauss = [
  [1.0, 0.004020153033244291, 0.005168620122316926, 0.008351769969783669, 0.0035028226091171465, 0.006196020066304519, 0.007774524087218986, 0.0035902554935677887, 0.006863242098188404, 0.004145402585536839],
  [1.0, 0.09802870340753762, 0.04086120286634459, 0.04044302938405207, 0.027459056132464466, 0.01888104679971534, 0.025291394591702474, 0.010556916278703001, 0.015428539115196937, 0.02088319308047196],
  [1.0, 0.19234836424386256, 0.13967533111379973, 0.10703842041533022, 0.0992485998754531, 0.09481465555125561, 0.0923021286313776, 0.10882249470419447, 0.10832340815014427, 0.10338019904988709],
  [1.0, 0.30653306860769836, 0.2274436647478381, 0.2005664496937375, 0.19525833088014088, 0.20642784686407023, 0.20537602750519987, 0.20338196730296398, 0.1958845901749618, 0.20156959006454528],
  [1.0, 0.39034571975646737, 0.32808692619821345, 0.2957904387050337, 0.3059622889069441, 0.3009561380020085, 0.29237693797786046, 0.3074607508810028, 0.30860518014434485, 0.30011100337092644],
  [1.0, 0.5065951320713825, 0.41816693651872466, 0.39781975677663245, 0.39536190952870814, 0.40897210268855455, 0.3957175600049864, 0.3975358589483791, 0.39273855608625174, 0.3957276401575928],
  [1.0, 0.5998008280681483, 0.5152650138529891, 0.5004733377883046, 0.5098278964641801, 0.5076426918681779, 0.4954990459076507, 0.5070793618952537, 0.49423147658092903, 0.5052828084870429],
  [1.0, 0.705532962741416, 0.6166421769756882, 0.5920594946580827, 0.5948393054016806, 0.6011141612402171, 0.5989836817370429, 0.5977201288924754, 0.6081266601742161, 0.5987644712753529],
  [1.0, 0.800476520685399, 0.7192218395813443, 0.6949210035478018, 0.7067366324116717, 0.7067650392546251, 0.7058942735324482, 0.6984705503262498, 0.7030979314132039, 0.7076559105714343],
  [1.0, 0.90562376257891, 0.8114338272546836, 0.7950726413554353, 0.7986664835295842, 0.7902807902427484, 0.8089249311766838, 0.7942554308739032, 0.8000546546295032, 0.7919591047500569]
];

// Transformamos los datos al formato requerido por Plotly.
var data = [
  { 
    z : recursive, 
    visible : true,
    type : 'surface', 
    opacity : 0.75,
    name : 'Recursive',
    colorscale : 'Rainbow',
    showscale : false,
    hoverinfo : 'all'
  },

  { 
    visible : true,
    z : simulated, 
    type : 'surface', 
    opacity : 0.75,
    name : 'Simulation',
    colorscale : 'Picnic',
    showscale : false
  },

  { 
    visible : true,
    z : gauss,
    type : 'surface', 
    opacity : 0.75,
    name : 'Direct',
    colorscale : 'Earth',
    showscale : false
  }
];

var layout = {
      title : 'Blocking probability of BCC',
      width : 994,
      height : 600,

      scene : {
            xaxis : {
                  title : 'S',
                  type : 'linear',
                  tickmode : 'linear',
                  tick0: 0,
                  dtick: 1,
                  ticks : 'inside',
                  mirror : false
            }, 

            yaxis : {
                  title : '\u03bb / \u03bc',
                  type : 'linear',
                  tickmode : 'linear',                  
                  tick0 : 0,
                  dtick: 1,
                  ticks : 'outside',
                  mirror : false
            },

            zaxis : {
                  title : 'Block prob.'
            }
      }
}

// Creamos el widget para visualizar los datos.
Plotly.plot('experiment', data, layout);

// Agregamos los eventos para mostrar/ocultar a los botones
$('.control-div button').click(function() {
      var index = -1;

      if(this.id === 'recursive') 
            index = 0;
      else if (this.id === 'sim') 
            index = 1;
      else if (this.id === 'gauss') 
            index = 2;
      else 
            index = -1;

      if(index === -1) {
            console.warn('Unknown id: ' + this.id);
            return;
      } else {
            plot = document.getElementById('experiment');
            var op = plot.data[index].opacity;

            if(op === undefined) op = 1.0;

            var update = {
                  opacity : (op === 1 ? 0.75 : 1.0)
            }

            Plotly.restyle(plot, update, index);
      }
});