/**
* bcc.js
*
* Este script contiene los datos de la simulacion del experimento con
* el protocolo BCC (Blocked Customer Cleared).
*
* @author Jose Aguilar-Canepa
*/

/** 
* Estos datos corresponden a la resolucion de la cadena utilizando 
* el metodo recursivo.
*/
var recursive = [
  [1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.5, 0.5, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.14285714285714285, 0.2857142857142857, 0.5714285714285714, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.025, 0.075, 0.225, 0.675, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.002932551319648094, 0.011730205278592375, 0.0469208211143695, 0.187683284457478, 0.750733137829912, 0.0, 0.0, 0.0, 0.0, 0.0],
  [2.560163850486431E-4, 0.0012800819252432156, 0.006400409626216078, 0.03200204813108039, 0.16001024065540195, 0.8000512032770097, 0.0, 0.0, 0.0, 0.0],
  [1.7861289227856465E-5, 1.071677353671388E-4, 6.430064122028329E-4, 0.0038580384732169967, 0.02314823083930198, 0.13888938503581189, 0.8333363102148713, 0.0, 0.0, 0.0],
  [1.0407993338884262E-6, 7.285595337218984E-6, 5.099916736053289E-5, 3.5699417152373024E-4, 0.0024989592006661116, 0.017492714404662782, 0.12244900083263947, 0.8571430058284762, 0.0, 0.0],
  [5.2154064567044855E-8, 4.1723251653635884E-7, 3.3378601322908708E-6, 2.6702881058326966E-5, 2.1362304846661573E-4, 0.0017089843877329258, 0.013671875101863407, 0.10937500081490725, 0.875000006519258, 0.0],
  [2.294377593291974E-9, 2.0649398339627766E-8, 1.858445850566499E-7, 1.6726012655098492E-6, 1.5053411389588642E-5, 1.354807025062978E-4, 0.0012193263225566801, 0.01097393690301012, 0.09876543212709109, 0.8888888891438197]
];

/**
* Estos datos corresponden a la resolucion de la cadena utilizando
* una simulacion de la cadena.
*/
var simulated = [
  [1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.5885843751924832, 0.5956600583435057, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.19720108156491434, 0.3256038690175079, 0.582871178034342, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.04272356030662823, 0.07884473462961042, 0.32273382257808386, 0.7640013465166156, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.06790463427099681, 0.09613592127586987, 0.05862045875532326, 0.26231257969041927, 0.8308626564135153, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.07854347699063045, 0.04129242014701565, 0.07677990940676249, 0.04243920094399931, 0.24453959464530595, 0.8390864594291061, 0.0, 0.0, 0.0, 0.0],
  [0.09092281373946544, 0.03658848278196773, 0.08905195397221283, 0.07006645226293992, 0.061967749130142066, 0.1417190806820369, 0.8842721292516325, 0.0, 0.0, 0.0],
  [0.07494126034224058, 0.03478847503192997, 0.08367241387244279, 0.050539300356971566, 0.057262257328148686, 0.09402434907967791, 0.13919333023527355, 0.8646660172744346, 0.0, 0.0],
  [0.053366453662524904, 0.09770853382339185, 0.031349572475423616, 0.04877621800514892, 0.04125376057974463, 0.06115983491277301, 0.08883684171657687, 0.19192123848097822, 0.9176250154770943, 0.0],
  [0.035660871165097356, 0.020525693832275076, 0.026958165223873235, 0.06722770223412332, 0.046235625866352686, 0.09097727416983283, 0.07946844606186639, 0.022732936071778932, 0.15033654096477347, 0.89195845822194]
];

/**
* Estos datos corresponden a la resolucion de la cadena mediante el 
* metodo de Gauss-Seidel.
*/
var gauss = [
  [1.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.5048293386305432, 0.5058187164202024, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.14575408003458004, 0.2858441523482778, 0.5721731604908697, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.028919758860797132, 0.0781421784913851, 0.22724099760646382, 0.6818728124670581, 0.0, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.004502094995916999, 0.017523923634411562, 0.049544063136960005, 0.19027085371437566, 0.7573458683134073, 0.0, 0.0, 0.0, 0.0, 0.0],
  [0.008997145184997099, 0.007007843066135043, 0.014238043462277306, 0.04018187694087282, 0.16235758393509409, 0.8043420685925851, 0.0, 0.0, 0.0, 0.0],
  [0.004134138059911534, 0.0018045482898492572, 0.009104771945755373, 0.00500388465336297, 0.03301489699424222, 0.14504995970378867, 0.8421461491973367, 0.0, 0.0, 0.0],
  [0.009299407282017724, 0.008280202082641207, 0.00920055071663256, 6.798499000448411E-4, 0.010242702114627631, 0.02468565859415409, 0.1322169310594828, 0.8603276857303804, 0.0, 0.0],
  [0.007858021122673736, 0.008108857352713921, 0.0021951850169166145, 0.005924148757660021, 0.005573963301109974, 0.00510788506145291, 0.016511943800372166, 0.10988118790982018, 0.8808240714091999, 0.0],
  [0.008990809559297245, 0.0023105222006431377, 2.72925361841615E-4, 0.007503923293685378, 0.0025047320506774756, 0.009311170916446473, 0.0027714788203644916, 0.014814118841575553, 0.10403729733012919, 0.895378547308907]
];

// Transformamos los datos al formato requerido por Plotly.
var data = [
  { 
    z : recursive, 
    visible : true,
    type : 'surface', 
    opacity : 0.75,
    name : 'Recursive',
    colorscale : 'Rainbow',
    showscale : false,
    hoverinfo : 'all'
  },

  { 
    visible : true,
    z : simulated, 
    type : 'surface', 
    opacity : 0.75,
    name : 'Simulation',
    colorscale : 'Picnic',
    showscale : false
  },

  { 
    visible : true,
    z : gauss,
    type : 'surface', 
    opacity : 0.75,
    name : 'Direct',
    colorscale : 'Earth',
    showscale : false
  }
];

var layout = {
      title : '\u03c0i of Finite BCD',
      width : 994,
      height : 600,

      scene : {
            xaxis : {
                  title : 'S',
                  type : 'linear',
                  tickmode : 'linear',
                  tick0: 0,
                  dtick: 1,
                  ticks : 'inside',
                  mirror : false
            }, 

            yaxis : {
                  title : 'i',
                  type : 'linear',
                  tickmode : 'linear',                  
                  tick0 : 0,
                  dtick: 1,
                  ticks : 'outside',
                  mirror : false
            },

            zaxis : {
                  title : '\u03c0i'
            }
      }
}

// Creamos el widget para visualizar los datos.
Plotly.plot('experiment', data, layout);

// Agregamos los eventos para mostrar/ocultar a los botones
$('.control-div button').click(function() {
      var index = -1;

      if(this.id === 'recursive') 
            index = 0;
      else if (this.id === 'sim') 
            index = 1;
      else if (this.id === 'gauss') 
            index = 2;
      else 
            index = -1;

      if(index === -1) {
            console.warn('Unknown id: ' + this.id);
            return;
      } else {
            plot = document.getElementById('experiment');
            var op = plot.data[index].opacity;

            if(op === undefined) op = 1.0;

            var update = {
                  opacity : (op === 1 ? 0.75 : 1.0)
            }

            Plotly.restyle(plot, update, index);
      }
});